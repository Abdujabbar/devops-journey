import { Callout } from "nextra-theme-docs";

# Serverlarni monitoring qilish yoxud Grafana, Prometheus, Node Exporter o'rnatish va sozlash

![Linux](/images/article/monitoring/1.png)


Aksariyat sysadminlar o'z serverlari qanday ishlashi haqida to'liq ma'lumotga ega bo'lishni xohlashadi. Server protsessorlari, xotirasi va I/O statistikasining ko'rinishi ularga muammolarni yuzaga kelishidan oldin aniqlash va ajratishga yordam beradi. Prometheus client nodelaridan foydali statistik ma'lumotlarni yig'ish uchun robust node monitoringi yechimini taklif etadi. Grafana vizualizatsiya yechimi bilan birgalikda Prometheus foydalanuvchilarga serverning asosiy statistikasini vizual kuzatish imkonini beradi.

## Prometheus nima?

Prometheus - bu muntazam ravishda server metriclarini(metrikalarini) to'playdigan open source tizim monitoringi ilovasi. U o'zining xost-serverini hamda tashqi clientlarni kuzatishi mumkin. Prometheus barcha clientlar uchun tashqi ish faoliyatini nazorat qilish imkonini beradi, bu mumkin bo'lgan xatolar yoki kutilmagan xatti-harakatlarni erta aniqlash imkonini beradi. Har bir client o'zining ichki statistikasini to'plash va oshkor qilish uchun exporter sifatida tanilgan metrics collation vositasini ishga tushirishi kerak. Xavfsizlik nuqtai nazaridan, Prometheus shu tarzda ma'lumotlarni yig'maydigan external nodeni kuzata olmaydi.

Prometheus serveri talab qilinadigan ma'lumotlar uchun client serverlarini so'rash uchun HTTP protokolidan foydalanadi. U har bir clientni oldindan belgilangan vaqt oralig'ida so'rov qilib, natijalarning time-seriali ma'lumotlar bazasini saqlaydi. Prometheus statistik ma'lumotlar qachon olinganligini ko'rsatadigan timestamplari bilan birga discrete snapshotlarni saqlaydi. Prometheus o'zi to'plagan metricalarni saqlab qoladi, bu esa clientning uzoq muddatli faoliyatining umumiy ko'rinishini yaratishga imkon beradi.

Client nodelarida turli statistik collectorlardan foydalanish mumkin bo'lsa-da, Prometheus o'zining Node Exporter tool tavsiya qiladi. Prometheus Node Exporter ko'p sonli hardware va kernel metriclarini, jumladan CPU va xotiradan foydalanishni to'playdi. To'plangan mavjud metriclarning to'liq ro'yxatini [Node Exporter GitHub sahifasida](https://github.com/prometheus/node_exporter) topish mumkin. Node Exporter Prometheus bilan chambarchas integratsiyalashgan va bir xil ma'lumotlar formatini baham ko'radi. Node Exporter va Prometheusni birgalikda ishlatish uchun hech qanday konversiya yoki dastlabki ishlov berish talab etilmaydi. Node Exporter monitoring qilish uchun har bir clientga o'rnatilishi kerak. Node Exporter 9100 portidan, Prometheus esa 9090 portidan foydalanadi. Prometheus haqida qo'shimcha ma'lumot olish uchun [Prometheus texnik hujjatlariga](https://prometheus.io/docs/introduction/overview/) qarang.

Prometheusning ba'zi qo'shimcha xususiyatlari quyidagilardir.

* Bu open source va har qanday kompaniyadan mustaqil
* Har bir Prometheus serveri avtonomdir va taqsimlangan xotira(distributed storage) yoki markaziy serverni(central server) talab qilmaydi
* Bu juda ishonchli va o'rnatish oson
* Turli xil clientlarni turli vaqt oralig'ida so'rash mumkin
* Time-seriyali ma'lumotlar va key-value pairlarini qo'llab-quvvatlaydigan moslashuvchan ko'p o'lchovli ma'lumotlar modelidan foydalanadi
* Ma'lumotlarni olish va tahlil qilish uchun `PromQL` so'rovlar tilini(query language) qo'llab-quvvatlaydi
* U AlertManger komponentini o'z ichiga oladi. AlertManager clientlardan ogohlantirishlarni(slerts) oladi va ularni turli obunachilarga yuboradi
* Prometheus o'z metrikalarini Grafana kabi vizualizatsiya vositalariga kiritishi mumkin
* Ixtiyoriy Prometheus PushGateway push-ga asoslangan metrik to'plamni qo'llab-quvvatlaydi
* U sozlanishi va uchinchi tomon kutubxonalarini qo'llab-quvvatlaydi
* U Docker konteynerlashtirish va Kubernetes-ni qo'llab-quvvatlaydi
* Prometheus katta va faol ishlab chiquvchilar va foydalanuvchilar hamjamiyatiga ega

## Grafana nima?

Grafana - bu open source va korporativ nashrlarda mavjud vizualizatsiya ilovasi. Grafana mijozlardan hech qanday metrikalarni yig'maydi va hech qanday ma'lumotlarni saqlamaydi. Buning o'rniga, Grafana foydalanuvchi interfeysi Prometheus yoki boshqa ma'lumotlar manbasi tomonidan to'plangan metrikalarni intuitiv va vizual tarzda chiroyli formatda namoyish etadi. Grafana dashboard yordamida ma'lumotlarni taqdim etadi. Dashboard ko'rsatiladigan qiymatlarni va ularni qanday ko'rsatishni aniqlash uchun shablondir. Aksariyat dashboard foydalanuvchilarga taqdimotni ko'proq nazorat qilish imkonini beruvchi qo'shimcha imkoniyatlarni taqdim etadi.

Grafana keng doiradagi dashboardni, jumladan Prometheus Node Exporter boshqaruv panelini qo'llab-quvvatlaydi. Grafana-da  [Grafana Dashboard Library](https://grafana.com/grafana/dashboards/) tasdiqlangan dashboard mavjud. Shuningdek, u foydalanuvchilarga o'z panellarini yaratish va ma'lumotlar manbasida o'z querylarini bajarish imkonini beradi. Grafana shuningdek, SQL yoki NoSQL ma'lumotlar bazalariga va Jira va GitLab kabi ilovalariga ulanishi mumkin. Bir xil boshqaruv panelida bir nechta ma'lumotlar manbalari birlashtirilishi mumkin.


Grafana ogohlantirishlar(alerts), annotationlar, dashboard variablelari, plaginlar va autentifikatsiyani qo'llab-quvvatlaydi. Shuningdek, u ma'lumotlarni yanada dekonstruksiya qilish uchun bir qator tahliliy vositalarni taqdim etadi. Grafana veb-interfeysiga xost-serverning `3000`-porti yordamida kirish mumkin. Eng yaxshi natijalarga erishish uchun Prometheus va Grafana-ni bitta serverda ishga tushiring. Qo'shimcha ma'lumot olish uchun Grafanaga [texnik hujjatlariga](https://grafana.com/docs/grafana/latest/introduction/) qarang.


### Talablar
* Prometheus 4 GB RAM va 20 GB disk xotira talab qiladi va kamida ikkita CPU core bilan yaxshi ishlaydi.


## Prometheus, Grafana va Node Exporter-ni o'rnatish va sozlash

Ushbu ko'rsatmalarda Prometheus serveriga ega tizim "monitoring serveri" deb ataladi. Kuzatilayotgan tizim "client" hisoblanadi. Prometheus va Grafana yordamida juda murakkab maxsus exporterlar va dashboardni ishlab chiqish mumkin. Biroq, ushbu qo'llanma clientning eng muhim tafsilotlarini, jumladan CPU, xotira va I/O-dan foydalanishni kuzatish uchun yanada sodda yechimni tasvirlaydi. Bu PromQL haqida hech qanday ma'lumotni yoki Prometheus yoki Grafana uchun past darajadagi tafsilotlarni talab qilmaydi.

#### Sozlash uchun quyidagi amallarni bajarish talab etiladi.

* 1.Monitoring serverga Prometheusni yuklab olish va o'rnatish
* 2.Prometheusni service sifatida ishlatish uchun sozlash.
* 3.Node Exporter dasturini barcha clientlarga o'rnatish.
* 4.Clientlarni kuzatish uchun Prometheusni sozlash.
* 5.Grafana serverini o'rnatish va joylashtirish.
* 6.Grafana va Prometheusni birlashtirish.
* 7.Node Exporter statistikasi uchun dashboardni import qilish.

## Prometheus o'ratish va sozlash

Prometheusni GitHub repositoriyadan oldindan kompilyatsiya qilingan binary(ikkilik) fayl sifatida yuklab olish mumkin.  [Prometheus Downloads](https://prometheus.io/download/) repositoriyada Prometheusning eng so'nggi relizlari ro'yxati keltirilgan. [Prometheus GitHub sahifasida](https://github.com/prometheus/prometheus), shuningdek, Prometheusni source kodidan(manba kodi) build qilish yoki uni Docker konteyneri sifatida ishga tushirish bo'yicha ko'rsatmalar mavjud. Prometheusni yuklab olish uchun quyidagi amallarni bajaring.

1. [Prometheus downloads](https://prometheus.io/download/) sahifasiga tashrif buyuring va eng so'nggi versiyani yozib oling. Eng so'nggi LTS versiyasi saytda aniq ko'rsatilgan.

2. Monitoring serveriga Prometheusni yuklab olish uchun `wget` dan foydalaning. Maqsadli havola https://github.com/prometheus/prometheus/releases/download/v[release]/prometheus-[release].linux-amd64.tar.gz formatiga ega. Yuklab olish uchun [release] qatorini haqiqiy reliz bilan almashtiring. Masalan, quyidagi yuklash buyruqlari 2.46.0 versiyasini chiqaradi.

```bash
wget https://github.com/prometheus/prometheus/releases/download/v2.46.0/prometheus-2.46.0.linux-amd64.tar.gz
```
3. Arxivlangan Prometheus fayllarini arxivdan chiqarib oling.

```bash
tar xvfz prometheus-*.tar.gz
```
4. (Ixtiyoriy) Fayllar arxivdan chiqarilgandan so'ng, arxivni o'chiring yoki saqlash uchun boshqa joyga ko'chiring.
```bash
rm prometheus-*.tar.gz
```
5. Prometheus foydalanishi uchun ikkita yangi jild yarating. `/etc/prometheus` jildi Prometheus konfiguratsiya fayllarini saqlaydi. `/var/lib/prometheus` jildi dastur ma'lumotlarini saqlaydi.

```bash
sudo mkdir /etc/prometheus /var/lib/prometheus
```
6. Arxivdan chiqarilgan Prometheus jildiga kiring

```bash
cd prometheus-2.46.0.linux-amd64
```

7. Prometheus va promtool jildlarini `/usr/local/bin/` jildiga o'tkazing. Bu Prometheusni barcha foydalanuvchilar uchun ochiq qiladi.

```bash
sudo mv prometheus promtool /usr/local/bin/
```
8. `prometheus.yml` YAML konfiguratsiya faylini `/etc/prometheus` jildiga o'tkazing.

```bash
sudo mv prometheus.yml /etc/prometheus/prometheus.yml
```
9. `consoles` va `console_libraries` jildlari moslashtirilgan konsollarni yaratish uchun zarur bo'lgan resurslarni o'z ichiga oladi. Bu xususiyat yanada rivojlangan va ushbu qo'llanmada yoritilgan. Biroq, agar kerak bo'lsa, bu fayllar `etc/prometheus` jildiga ko'chirilishi kerak.

```bash
sudo mv consoles/ console_libraries/ /etc/prometheus/
```
10. Quyidagi buyruq yordamida Prometheus muvaffaqiyatli o'rnatilganligini tekshiring:
```bash
prometheus --version
```

