import { Callout } from "nextra-theme-docs";

import Image from 'next/image'

![k8s](/images/tutorials/k8s/objects/2.jpeg)

## Kubernetes Obyektlari

Kubernetes - konteyner operatsiyalarini avtomatlashtiradigan open source platforma. Bu konteynerlashtirilgan ilovalarni deploy qilish va scaling(masshtablash) bilan bog'liq ko'plab qo'lda ishlov berish jarayonlarini avtomatlashtiradi. Asosan, Kubernetes distributed systemlarni barqaror ishlash uchun asos yaratadi, ilovangiz uchun masshtablash(scaling ) va failover, deploy qilish patternlarini taʼminlaydi va hokazo. Masalan, Kubernetes tizimingiz uchun canary deploymentni osongina boshqarishi mumkin.

U dastlab Google tomonidan ishlab chiqilgan va hozirda `Cloud Native Computing Foundation` tomonidan yuritiladi. Tizim yagona birlik sifatida ishlash uchun ulangan kompyuterlarning yuqori darajada mavjud(highly available) clusterini muvofiqlashtiradi. U taqdim etgan abstraction sizga konteynerlashtirilgan ilovalarni alohida machinelarga bog'lamasdan clusterga deploy qilish imkonini beradi.

Kubernetes cluster bo'ylab dastur konteynerlarini yanada samaraliroq taqsimlash(distribution) va rejalashtirishni(scheduling) avtomatlashtiradi. Kubernetes clusteri konteynerlashtirilgan ilovalarni ishga tushiradigan nodelar deb ataladigan worker machinelar(ishchi serverlar) to'plamidan iborat. Har bir clusterda kamida bitta worker node mavjud.

Worker node(lar) dastur workloadning komponentlari bo'lgan podlarni joylashtiradi. Control plane worker nodelarni va clusterdagi podlarni boshqaradi. Production environmentida control plane odatda bir nechta kompyuterlar bo'ylab ishlaydi va cluster odatda xatolarga chidamlilik va yuqori mavjudlikni(high availability) ta'minlaydigan bir nechta nodelarni boshqaradi.

Kubernetes shuningdek, service discovery va load balancing, storage orchestration, avtomatlashtirilgan rollout(ishga tushirish) va rollback(orqaga qaytarish), self-healing(o'z-o'zini davolash), secret va configuration managementni taklif qiladi. Bu xususiyatlar murakkab deployment va operatsiyalarni, jumladan, zero-downtime, oldingi versiyalarga qaytarish(rollback) va ilovalaringiz uchun maxfiy maʼlumotlarni boshqarish imkonini beradi.

Bundan tashqari, Kubernetes kengaytiriladigan boʻlishi uchun moʻljallangan boʻlib, Custom Resource Definitionlari kabi xususiyatlarga ega boʻlib, sizga oʻz API resurslaringizni yaratishga imkon beradi va uni turli workflowlari va foydalanuvchi ehtiyojlariga moslashtiradi. Bu Kubernetesni konteyner orkestratsiyasi va cloud-native development sohasida poydevor sifatida mustahkamlab, uning atrofida tollar, servicelar va qo'llab-quvvatlashning keng ekotizimiga olib keldi.

Kubernetes obyektlari Kubernetes tizimidagi doimiy obyektlardir(persistent entities). Kubernetes ushbu obyektlardan clusteringiz holatini(stateni) ko'rsatish uchun foydalanadi. Kubernetes obyekti odatda o'zi ko'rsatadigan resurs uchun **"desired state(kerali holat)"** ni belgilaydi. Kubernetes tizimi obyekt tomonidan ko'rsatilgan istalgan holatga mos keladigan joriy holatni doimiy ravishda boshqaradi.

![k8s](/images/tutorials/k8s/objects/1.png)

Har bir obyekt obyekt konfiguratsiyasini belgilaydigan ikkita ichki o'rnatilgan obyekt maydonini o'z ichiga oladi: `object spec` va `object status`.

* Siz taqdim etishingiz kerak bo'lgan `spec`(spetsifikatsiya) obyektning kerakli stateni(holatini) tavsiflaydi.
* `status` Kubernetes tizimi tomonidan taqdim etilgan va yangilangan obyektning joriy holatini tavsiflaydi. 

Obyektlar odatda `YAML` yoki `JSON` fayllarida aniqlanadi va keyin Kubernetes API bilan yaratiladi. Obyekt `kind`(turi) siz yaratmoqchi bo'lgan Kubernetes obyektining turini belgilaydi, masalan, Pod, Service yoki Deployment.


<Callout type="info" emoji="">
Diqqat!!! Ushbu qo'llanmada barcha Kubernetes Obyektlari qisqa yoritilgan. Keyingi qismlarda har bir Obyektlar to'liqroq yoritiladi!
</Callout>

<div style={{ display: 'flex', alignItems: 'center', lineHeight: '40px' }}>
  <img
    src="https://github.com/kubernetes/community/raw/master/icons/png/resources/labeled/pod-128.png"
    alt="Pod icon"
    style={{ height: '40px', marginRight: '10px' }}
  />
  <h3 style={{ margin: '0', fontWeight: 'bold', fontSize: '25px' }}>Pod</h3>
</div>
### Pod

![k8s](/images/tutorials/k8s/objects/5.png)

Kubernetesdagi pod - Kubernetes ilovalarining asosiy qurilish bloki bo'lib, u yaratilishi(create), rejalashtirilishi(schedule) va boshqarilishi mumkin bo'lgan eng kichik deploymment unit vazifasini bajaradi. Bu, asosan, bir yoki bir nechta konteynerlarni o'rab oladigan, odatda mahkam bog'langan va resurslarni bo'lishishi kerak bo'lgan o'ram(wrapper). Har bir Pod o'zining IP manzili bilan ishlaydi, bu unga Kubernetes clusteridagi boshqa Podlar va servicelar bilan bog'lanish imkonini beradi. Pod ichida konteynerlar IP-manzil va port spaceni almashadilar va bir-birlarini `localhost` orqali topishlari mumkin. Ular, shuningdek, Pod levelida ko'rsatilgan Kubernetes volumelari orqali fayllarni almashishlari mumkin.

Pod yaratilganda, u clusterdagi node ustida ishlashi rejalashtirilgan va jarayon tugatilgunga qadar, Pod o'chirilguncha, Pod biron sababga ko'ra chiqarib yuborilmaguncha yoki node ishlamay qolguncha u erda qoladi. Har bir Pod holati Kubernetes API da taqdim etilgan va uni Kubernetes API yoki uning buyruq qatori interfeysi orqali boshqarish mumkin.

#### Pod anatomiyasi
**Konteynerlar**  Har bir pod bir yoki bir nechta konteynerlarni ishlatish uchun mo'ljallangan. Bular Docker instancelari yoki application kodingizni saqlaydigan boshqa konteyner runtime muhiti.

**Volumelar** Pod shared storage volumelari to'plamini belgilashi mumkin. Pod ichidagi konteynerlar ma'lumotlarni almashish uchun ushbu volumelardan foydalanishi mumkin. Volumelar, shuningdek, konteynerni qayta ishga tushirishda ma'lumotlarning saqlanib qolishiga imkon beradi.

**Networking** Har bir Podga cluster ichida noyob IP-manzil beriladi, bu esa ilovalarga portlardan ziddiyat xavfisiz foydalanish imkonini beradi. Pod ichidagi konteynerlar network namespaceni baham ko'radi, ya'ni ular `localhost` yordamida bir-biri bilan bog'lanishlari mumkin.

**Pod haqida ma'lumot** Bunga Pod nomi, noyob(unique) UID va namespacelar kiradi.

#### Pod Lifecycli

**Yaratish(Creation)** Pod yaratilganda (odatda Deployment orqali yoki to'g'ridan-to'g'ri YAML faylidagi Pod ta'rifidan), Kubernetes master Podni clusterdagi ma'lum bir nodeda ishlashni rejalashtiradi(schedule).

**Ishlash(Running)** Nodedagi kubelet, agar mavjud bo'lmasa, kerakli konteyner imagelarini tortib(pull) olgandan so'ng, konteynerning runtimedan foydalanib, Pod spetsifikatsiyasida belgilangan konteynerlarni ishga tushiradi.

**Termination** Podlar jarayonlari tugallangandan so'ng qulay tarzda tugatilishi yoki ularni majburan o'chirib(force delete) tashlashi mumkin. Pod terminate qilinganda, uning resurslari bo'shatiladi va uning IP manzili qayta ishlanadi.

Kubernetes scheduler resurslar mavjudligi, cheklovlar, affinity specificationlari va boshqa omillarga asoslanib, Pod qaysi nodeda ishlashini aniqlaydi.

#### Pod Communication

**Pod-to-Pod Communication** Podlar bir-biri bilan IP manzillari orqali nodelar bo'ylab aloqa qiladi. Nodelar bo'ylab ushbu podlar aro aloqa clusterdagi overlay network orqali amalga oshiriladi.

**Pod-to-Service Communication** Podlar odatda belgilangan IP-manzilga ega bo'lgan servicelar bilan bog'lanadi. Bu Pod masshtablash(scaling) va Pod nosozliklarini abstraksiya qilish imkonini beradi, chunki Service IP barqaror bo'lib qoladi.

#### Multi-Container Podlar

Podlar birgalikda ishlashi kerak bo'lgan bir nechta konteynerlarni ishlatishi mumkin. Birgalikda joylashgan ushbu konteynerlar yagona Service ko'rsatish birligini(single cohesive unit) tashkil qiladi, masalan, shared volumeda saqlangan ma'lumotlarga Service ko'rsatadigan bitta konteyner, boshqa sidecar(qo'shni) konteyner esa bu fayllarni refresh qiladi yoki yangilaydi. Ko'p konteynerli(multi-container) Poddagi konteynerlar xuddi bitta konteyner kabi bir xil lifecycle, local network va storagega ega.

![k8s](/images/tutorials/k8s/objects/4.png)

#### Best Practica!

***Podlar stateless va immutable(oʻzgarmas) boʻlishi kerak:*** hech qanday doimiy(persistent) maʼlumotlarni toʻgʻridan-toʻgʻri Podda saqlamang va Podning compute konfiguratsiyasi qayta ishga tushirilganda ham davom etishini kutmang. Sizda barcha saqlangan ma'lumotlar o'chib ketadi!!!

**Stateful ilovalar StatefulSet-dan foydalanishi kerak:** Ular doimiy(persistent) ma'lumotlar va holatga oid(stateful) ilovalar bilan ishlash uchun mo'ljallangan bo'lib, hatto Podni qayta yaratish kerak bo'lganda ham bu holat saqlanishini ta'minlaydi.

**Stateless ilovalar uchun Deploymentdan foydalaning:** Deploymentlar maʼlum miqdordagi Podlar ilova kodini ishlayotganligiga ishonch hosil qiladi.

Podlar ilovaning ish muhitini qamrab oladi: dasturiy ta'minot(software), runtime, kutubxonalar(library) va vaqtinchalik holatlar(ephemeral states). Podlarni tushunish juda muhim, chunki ular Kubernetes clusterida asosiy deploy qilinadigan  obyekt bo'lib Service qiladi.


<div style={{ display: 'flex', alignItems: 'center', lineHeight: '40px' }}>
  <img
    src="https://github.com/kubernetes/community/raw/master/icons/png/resources/labeled/svc-128.png"
    alt="Servicelar"
    style={{ height: '40px', marginRight: '10px' }}
  />
  <h3 style={{ margin: '0', fontWeight: 'bold', fontSize: '25px' }}>Servicelar</h3>
</div>
### Servicelar

![k8s](/images/tutorials/k8s/objects/6.png)

Kubernetesda Service - bu podlarning logical setini(to'plamini) va ularga kirish(access) policyni belgilaydigan abstraction. Ushbu abstraction iste'molchilarning(consumer) Podlar va Podlarni o'zlari qanday ko'rishlari o'rtasida ajratish imkonini beradi. Podlar doimiy bo'lmagan(non-permanent) resurslar bo'lsa, bu kashf qilish va doimiy mavjudlik(continuous availability) uchun muammo tug'diradi. Servicelar buni Podlarga oʻzining barqaror(stable) IP manzilini va Serviceni tanlash mezonlariga(selector criteria) mos keladigan joriy ishlayotgan Podlar toʻplamiga load-balancing qiluvchi trafikni berish orqali hal qiladi.

Servicelar Kubernetes obyektlarini guruhlash va tanlashning standart usuli bo‘lgan teglar(label) va selectorlardan foydalangan holda Podlar to‘plamiga mos keladi. Misol uchun, Service `app=backend` labeli bilan barcha podlarni boshqarish mumkin. Pod ushbu labelga ega bo'lsa va selectorga mos kelsa, trafik unga Service orqali yo'naltirilishi mumkin.

![k8s](/images/tutorials/k8s/objects/7.jpg)

Servicening asosiy rollaridan biri load balancingni(yukni muvozanatlash) boshqarishdir. Kubernetes har bir Servicega o'zining IP-manzilini va DNS nomini beradi, boshqa podlar uni topish va unga kirish uchun foydalanishi mumkin. Trafik Servicening IP-manziliga yo'naltirilganda, Service load balancing policy asosida tarmoq trafigini tegishli Podga avtomatik ravishda taqsimlaydi.

Kubernetes Servicelari bir nechta turlarni qo'llab-quvvatlaydi, ularning har biri Podlarga turli xil kirish imkonini beradi:

* **ClusterIP** Ushbu default tur Serviceni cluster-internal(ichki) IP-da ko'rsatadi. Ushbu qiymatni tanlash Serviceni faqat cluster ichidan foydalanish imkoniyatini beradi.
![k8s](/images/tutorials/k8s/objects/8.png)
![k8s](/images/tutorials/k8s/objects/12.jpg)

* **NodePort** Bu tur har bir nodening IP-da statik portda (NodePort) Service ko'rsatadi. NodePort Serviceni yo'naltiriladigan ClusterIP Serviceni avtomatik ravishda yaratiladi. NodePort Servicega cluster tashqarisidan `<NodeIP>:<NodePort>` so'rovi orqali murojaat qilishingiz mumkin.
![k8s](/images/tutorials/k8s/objects/9.png)
![k8s](/images/tutorials/k8s/objects/13.jpg)

* **LoadBalancer** Bu tur cloud providerlarining load balanceridan foydalangan holda Serviceni tashqi ko'rinishda(external) namoyish etadi(expose qiladi). NodePort va ClusterIP Servicelari, ular uchun tashqi load balanceri yo'nalishlari(route) avtomatik ravishda yaratiladi.
![k8s](/images/tutorials/k8s/objects/14.jpg)

* **ExternalName** Bu tur Serviceni externalNamening mazmuniga (masalan, `test.sanjar.uz`(domenga)) uning qiymati bilan `CNAME` yozuvini qaytaradi. Hech qanday proksi-server o'rnatilmagan.
![k8s](/images/tutorials/k8s/objects/15.png)

Servicelar Podlarning davom etayotgan holatini kuzatib boradi va trafikni faqat mavjud resurslarga yo'naltiradi, ya'ni Pod o'chib qolsa yoki o'chirilsa, Service trafikni qolgan sog'lom podlardan biriga yo'naltiradi. Bu o'zgaruvchan yangilanishlarni amalga oshirish va ilovalar uchun yuqori mavjudlikni ta'minlash usulini ta'minlaydi.

Selector-based discoveryga qo'shimcha ravishda, Servicelarni Kubernetesdagi DNS orqali topish mumkin. Service yaratilganda, unga DNS nomi beriladi, bu boshqa Servicelarga Servicening IP-manzilini hal qilish va haqiqiy Pod IP-larni bilmasdan muloqot qilish imkonini beradi.

Servicelar Kubernetes clusterida doimiy obyekt bo'lib qoladi, ular ko'pincha ular ko'rsatgan podlardan oshib ketadi. Ushbu barqarorlik tufayli Servicelar Kubernetes-ga asoslangan ilovaning network layerining muhim tarkibiy qismidir, chunki ular qayta rejalashtirish(rescheduling) yoki o'z-o'zini davolash(self-healing) tufayli cluster bo'ylab qayerda va qanday harakatlanishidan qat'i nazar, ishlaydigan podlarga kirish uchun izchil kirish nuqtasini ta'minlaydi.

