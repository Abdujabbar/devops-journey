import { Callout } from "nextra-theme-docs";

# Kubernetesda minkubedan foydalanib Wordpress va MySQL ko'tarish

![k8s](/images/tutorials/k8s/wordpress-k8s/1.png)

Ushbu qo'llanma sizga Minikube yordamida WordPress sayti va MySQL ma'lumotlar bazasini qanday deploy qilishni ko'rsatadi. Ikkala dastur ham ma'lumotlarni saqlash uchun `PersistentVolumes` va `PersistentVolumeClaims`-dan foydalanadi.

[PersistentVolume(PV)](https://kubernetes.io/docs/concepts/storage/persistent-volumes/) administrator tomonidan qo‘lda tayyorlangan yoki Kubernetes tomonidan [StorageClass](https://kubernetes.io/docs/concepts/storage/storage-classes) yordamida dinamik ravishda ta’minlangan clusterdagi storage qismidir. [PersistentVolumeClaim (PVC)](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims) foydalanuvchi tomonidan PV tomonidan bajarilishi mumkin bo'lgan saqlash so'rovidir. PersistentVolumes va PersistentVolumeClaims Pod life sikllaridan mustaqil bo'lib, podlarni qayta ishga tushirish(restart), qayta rejalashtirish(rescheduling) va hatto o'chirish orqali ma'lumotlarni saqlaydi.

<Callout type="info" emoji="">
* Eslatma
Bu deployment ishlab chiqarishda foydalanish holatlari uchun mos emas, chunki u bitta nusxali WordPress va MySQL podlaridan foydalanadi. WordPress-ni ishlab chiqarishda deploy qilish uchun [WordPress Helm Chart](https://github.com/bitnami/charts/tree/master/bitnami/wordpress)-dan foydalanishni o'ylab ko'ring.
</Callout>

<Callout type="info" emoji="">
* Eslatma
Ushbu qo'llanmada taqdim etilgan fayllar GA Deployment API'laridan foydalanadi va kubernetesning 1.9 va undan keyingi versiyalariga xosdir. Agar siz ushbu qo‘llanmadan Kubernetesning oldingi versiyasi bilan foydalanmoqchi bo‘lsangiz, API versiyasini mos ravishda yangilang.
</Callout>

## Boshlashdan oldin

Sizda Kubernetes clusteri bo'lishi kerak va kubectl konsol dasturi sizning clusteringiz bilan bog'lanish uchun sozlangan bo'lishi kerak. Ushbu qo'llanmani control plane hostlari sifatida ishlamaydigan kamida ikkita nodeli clusterda ishga tushirish tavsiya etiladi. Agar sizda hali cluster bo'lmasa, [minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/) yordamida cluster yaratishingiz yoki Kubernetes playgroundlaridan birini ishlatishingiz mumkin:

<Callout type="info" emoji="">
Agar sizda minikube o'rnatilmagan bo'lsa minikube haqida yozgan qo'llanmamizdan foydalanishingiz mumkin. Qo'llanma: [Minkube](https://devops-journey.uz/guides/k8s/minikube)

Minkube yordamida multi-node cluster yaratmoqchi bo'lsez ushbu qo'llanmamaizdan foydalanishingiz mumkin. Qo'llanma: [Multi-Node Clusterdan foydalanish](https://devops-journey.uz/guides/k8s/minikube-multi-node) 
</Callout>

* Kubernetes Playgroundlari:
* [Killercoda](https://killercoda.com/playgrounds/scenario/kubernetes)
* [Play with Kubernetes](https://labs.play-with-k8s.com/)


Sizda `kubectl` o'rnatilgan bo'lishi kerak
Versiyani tekshirish uchun `kubectl version`-ni kiriting.
Ushbu sahifada ko'rsatilgan misol kubectl 1.27 va undan yuqori versiyalar bilan ishlaydi.

Quyidagi konfiguratsiya fayllarini yuklab oling:

<Callout type="info" emoji="">
* [mysql-deployment.yaml](https://kubernetes.io/examples/application/wordpress/mysql-deployment.yaml)
* [wordpress-deployment.yaml](https://kubernetes.io/examples/application/wordpress/wordpress-deployment.yaml)
</Callout>

## PersistentVolumeClaims va PersistentVolumes yaratish

MySQL va Wordpress har biri ma'lumotlarni saqlash uchun `PersistentVolume` talab qiladi. Ularning `PersistentVolumeClaims`lari joylashtirish bosqichida yaratiladi. Ko'pgina cluster environmentlarida standart `StorageClass` o'rnatilgan. Agar StorageClass PersistentVolumeClaimda ko'rsatilmagan bo'lsa, uning o'rniga clusterning standart StorageClass ishlatiladi. PersistentVolumeClaim yaratilganda, StorageClass konfiguratsiyasi asosida PersistentVolume dinamik ravishda ta'minlanadi.

<Callout type="info" emoji="">
**Ogohlantirish**: Local clusterlarda standart StorageClass `hostPath` provayderidan foydalanadi. hostPath hajmlari faqat ishlab chiqish va sinov uchun javob beradi. HostPath hajmlari bilan sizning ma'lumotlaringiz Pod rejalashtirilgan nodeda `/tmp` ichida yashaydi va nodelar o'rtasida harakatlanmaydi. Agar Pod o'lsa va clusterdagi boshqa nodega rejalashtirilsa yoki node qayta ishga tushirilsa, ma'lumotlar yo'qoladi.

**Eslatma**: Agar siz hostPath provayderidan foydalanishi kerak bo'lgan clusterni ochayotgan bo'lsangiz, controller-manager komponentida `--enable-hostpath-provisioner` flagini o'rnatilishi kerak.

**Eslatma**: Agar sizda `Google Kubernetes Engine(GKE)`-da ishlaydigan Kubernetes clusteringiz bo'lsa, iltimos, [ushbu qo'llanmaga](https://cloud.google.com/kubernetes-engine/docs/tutorials/persistent-disk) amal qiling.
</Callout>

## `kustomization.yaml` yaratish

`Secret generator`ni qo'shing

Secret - bu parol(password) yoki kalit(key) kabi nozik ma'lumotlarni saqlaydigan ob'ekt. 1.14 dan boshlab `kubectl` kustomizatsiya fayli yordamida Kubernetes ob'ektlarini boshqarishni qo'llab-quvvatlaydi. Siz `kustomization.yaml` da generatorlar tomonidan secret yaratishingiz mumkin.

Quyidagi buyruqdan `kustomization.yaml`-ga Secret generator qo'shing. `PAROLINGIZ` so‘zini foydalanmoqchi bo‘lgan parol bilan almashtirishingiz kerak bo‘ladi.

```bash
cat <<EOF >./kustomization.yaml
secretGenerator:
- name: mysql-pass
  literals:
  - password=PAROLINGIZ
EOF
```