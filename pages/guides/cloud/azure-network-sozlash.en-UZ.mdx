import { Callout } from "nextra-theme-docs";

# Azure Network sozlash

![azure-network-sozlash](/images/tutorials/cloud/azure-network/banner.png)

## Kirish

**Microsoft Azure** cloudda keng ko'lamli application va servicelarni deploy qilish uchun mustahkam va ko'p qirrali platformani taklif etadi. Uning asosiy xususiyatlaridan biri foydalanuvchilarga moslashuvchan va kengaytiriladigan tarmoq infratuzilmasini taqdim etuvchi virtual networklar (**VNets**) va **subnet**larni yaratish qobiliyatidir.

Azure-dan tarmoq uchun foydalanishning afzalliklaridan biri uning global mavjudligi, data centerlari butun dunyo bo'ylab strategik joylashgan. Bu foydalanuvchilarga resurslarni maqsadli auditoriyaga yaqinroq joylashtirish, kechikishni kamaytirish va umumiy ish faoliyatini yaxshilash imkonini beradi.

Azure-dagi virtual tarmoqlar foydalanuvchilarga clouddagi resurslarini logical ravishda izolatsiya qilib ajratish va segmentlarga ajratish imkonini beradi. Bu izolyatsiya kengaytirilgan xavfsizlik va tarmoq trafigi ustidan nazoratni ta'minlaydi, ruxsatsiz kirish va potentsial buzilishlarning oldini olishga yordam beradi. Bundan tashqari, **VNet** on-premises tarmoqlarga xavfsiz ulanishi mumkin, bu gibrid cloud senariylarni va mavjud infratuzilma bilan uzluksiz integratsiyani osonlashtiradi.

Virtual tarmoq ichida subnetlar resurslarni yanada tartibga soladi va trafik oqimini nazorat qiladi. **VNet**-ni bir nechta subnetlarga bo'lish orqali foydalanuvchilar o'zlarining talablaridan kelib chiqqan holda turli xil resurslar to'plamlariga maxsus IP-manzil diapazonlarini belgilashlari mumkin. Ushbu segmentatsiya tarmoq boshqaruvini yaxshilaydi va har bir kichik tarmoqqa moslashtirilgan tarmoq siyosatini amalga oshirish imkonini beradi.

Internal(ichki) IP-manzillar yordamida virtual tarmoq ichidagi resurslarni ulash bir qancha afzalliklarni beradi. Birinchidan, u Azure’ning yuqori tezlikdagi, low-latencyli tarmoq infratuzilmasidan foydalanish orqali resurslar o‘rtasidagi aloqani soddalashtiradi. Ikkinchidan, bu ma'lumotlarni uzatish bilan bog'liq xarajatlarni kamaytiradi, chunki bir xil VNet ichidagi resurslar o'rtasidagi trafik odatda bepul yoki VNet chegarasidan chiqadigan trafik bilan solishtirganda pastroq narxda olinadi. Nihoyat, internal IP-lardan foydalanish tarmoq miqyosini oshiradi, chunki resurslar ichki tarmoq konfiguratsiyasini o'zgartirmasdan qo'shilishi yoki olib tashlanishi mumkin.

Qisqa qilib aytganda Tashkilotning har bir loyihasi uchun alohida virtual network yaratish serverlarni internal IP bilan bo'glash eng yaxshi izolatsiya amaliyotlaridan biridir va bu network arxitekturani manage(boshqarish) oson.

Bugungi amaliyotimizda Azure cloudda Virtual network yaratib unda subnet yaratamiz va serverlar yaratib internal IPlar bilan birini bo'glaymiz. Bugungi amaliyot soddaroq lekin keyingi amaliyotlar uchun asos bo'ladi. Ushbu amaliyotda k8s-cluster sozlash uchun azure network sozlashni ko'rib chiqamiz k8s-cluster shunchaki bir namuna misol holos siz o'zingiz hohlagandek network sozlab olasiz.


## Ishni boshlash

Ushbu amaliyotda quyidagi rasmndagi arxitekturani quramiz.

![azure-network-sozlash](/images/tutorials/cloud/azure-network/architecture.png)

Bu amaliyotda **k8s-network** nomli virtual network yaratib olamiz unda **k8s-subnet** nomli subnet yaratib olamiz IP range **172.20.0.0/16** qilib belgilaymiz. Ushbu virtual networkdan foydalanib ikkita virtual machine(vm) yaratib olamiz va ularni internal IP lar bilan bo'glab bir bir bilan aloqasini tekshirib ko'ramiz. 

## Azure Virtual Network yaratish

Birinchi bo'lib ishni Azure Virtual Network yaratishdan boshlaymiz. Buning uchun [portal.azure.com](https://portal.azure.com/#home) kirib search qismidan virtual network deb qidirib kiramiz.

![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure1.png)

**Virtual networks**ga kirib `Create` bosamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure2.png)

Bizda Virtual network yaratish bo'limining `Bacis` qimsi ochiladi. Bu qismda **Subcribtion** tanlaymiz va bitta yangi `k8s-cluster` nomli **Resource group** yaratib olamiz. `Virtual network name`ga `k8s-network` deb nom beramiz va keyingi `IP addresses` qismiga o'tamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure3.png)

Ushbu qismda IPv4 range beramiz va subnet yaratib olamiz. Azure cloudda `default` subnetda bo'ladi bunda `10.0.0.0/16` IP range bo'ladi. Keling biz boshqa IP range yaratib `default` subnetni o'chirib o'zimiz subnet ochib olamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure4.png)

Biz `172.20.0.0/16` IPv4 range kirtamiz va `defaul` subnetni o'chirib tashlaymiz. 
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure5.png)
Yangi subnet qo'shish uchun `+ Add a subnet` bosamiz bizda subnet qo'shish oynasi ochiladi
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure6.png)
Ushbu oynada **subnet**imiz nomini yozamiz va IPv4 address rangeni kiritamiz va **Addd** qilib qo'shib olamiz.
Subnet qo'shganimizdan keyin quyidagicha ko'rinadi va biz `Review + create` qilib Virtual Network va Subnet yaratib olamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure7.png)
`Review + create` oynasi quyidagicha ochiladi biz `Create` bosib yaratib oilamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure8.png)

Yaratish jarayonim muvaffaqiyatli yakunlangada quyidagi oyna ochiladi va `Go to sesource` bosib ko'rishimiz mumkin.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure9.png)

![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure10.png)

Okey biz muvaffaqiyatli Virtual network va subnet yaratib oldik endi keyingio bosqichlarga o'tsak bo'ladi.

## Azure VM yaratish

Yuqorida biz muvaffaqiyatli  Resource group, virtual network va subnet yaratib oldik keling endi shu networkda Azure VMlar yaratamiz va internal IP lar orqali bir biriga ulanishini tekshiramiz.

Buning uchun [portal.azure.com](https://portal.azure.com/#home) kirib search qismidan virtual machine deb qidirib kiramiz.

![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm1.png)

`Virtual machines` bo'limga kirib **+ Create** bosib `Azure virtual machine`ni tanlab virtual machine yaratish qismiga o'tamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm2.png)

Bizda Virtual Machine yaratishning **Basics** qismi ochiladi. Ushbu qismdan `Resource group`ni yaratib olgan **k8s-cluster** nomli reseorce groupimizni belgilab qo'yamiz. **Virtual machine name:** ga vm nom beramiz va kerakli portlarni firewalldan ochib `Networking` qsimiga o'tamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm3.png)
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm4.png)

`Networking` qismida`Virtual network` qismida yaratib olgan **k8s-network** nomli virtual networkimizni belgilaymiz va `Subnet`ga esa **k8s-subnet**ni belgilaymiz va `Review + create` bosib oxirgi bosqichga o'tamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm5.png)

`Review + create` qsimida quyidagicha ochilishi kerak. `Create` bosib Azure VM yaratib olamiz.
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm6.png)
Networking qismi 
![azure-network-sozlash](/images/tutorials/cloud/azure-network/azure-vm7.png)

Virtual Machine yaratish jarayonida Azure serverga ssh orqali kirish uchun secret **.pem** key beradi keyni yuklab olamiz.

![azure-network-sozlash](/images/tutorials/cloud/azure-network/key.png)